# ğŸ›’ UK Retail Purchase Predictor â€” MLOps Level 0â€“2

[![Streamlit App](https://static.streamlit.io/badges/streamlit_badge_black_white.svg)](https://mastering-mlops-sa.streamlit.app/)

Predicts whether a UK customer will make a purchase **next month**, based on historical transaction data from the [Online Retail II UCI dataset](https://www.kaggle.com/datasets/mashlyn/online-retail-ii-uci).

Built as a complete MLOps demonstration covering manual training (Level 0), scripted pipelines (Level 1), and drift monitoring (Level 2) â€” deployed via **Streamlit**.

---

## ğŸ“ Project Structure

```
Mastering MLOps - Development to Deployment/
â”‚
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ raw.csv              â† Full dataset (generated by download_data.py)
â”‚   â”œâ”€â”€ train.csv            â† 70% split (generated by preprocess.py)
â”‚   â””â”€â”€ test.csv             â† 30% split (generated by preprocess.py)
â”‚
â”œâ”€â”€ models/
â”‚   â””â”€â”€ xgb_model.pkl        â† Trained XGBoost model (generated by train.py)
â”‚
â”œâ”€â”€ reports/
â”‚   â””â”€â”€ monitoring_report.txt â† Drift detection output (generated by monitor.py)
â”‚
â”œâ”€â”€ preprocess.py            â† Data cleaning, feature engineering, train/test split
â”œâ”€â”€ train.py                 â† XGBoost training, evaluation, model persistence
â”œâ”€â”€ monitor.py               â† Drift simulation and threshold-based detection
â”œâ”€â”€ app.py                   â† Streamlit prediction UI
â”œâ”€â”€ download_data.py         â† Kaggle dataset downloader
â”œâ”€â”€ retail_mlops_notebook.ipynb â† Full end-to-end Jupyter walkthrough
â”œâ”€â”€ requirements.txt         â† Runtime deps (Streamlit Cloud)
â”œâ”€â”€ requirements-dev.txt     â† Dev deps (kagglehub, pytest)
â”œâ”€â”€ conftest.py              â† Pytest root config
â””â”€â”€ README.md
```

---

## â˜ï¸ Streamlit Cloud Deployment

1. Push this repo to GitHub
2. Go to [share.streamlit.io](https://share.streamlit.io) â†’ **New app**
3. Select your repo â†’ Branch: `main` â†’ Main file: `app.py`
4. Click **Deploy** â€” done

> The `models/xgb_model.pkl` is committed to the repo so Streamlit Cloud can load it directly.  
> `data/raw.csv` is excluded (93 MB) â€” only needed to retrain locally.

---

## ğŸš€ Local Quick Start

### 1. Install dev dependencies
```bash
pip install -r requirements-dev.txt
```

### 2. Download the dataset
```bash
python download_data.py
```
Downloads **Online Retail II** from Kaggle â†’ saves to `data/raw.csv` (1M+ rows).

> No Kaggle API key needed â€” uses `kagglehub` anonymous download.

### 3. Run the preprocessing pipeline
```bash
python preprocess.py data/raw.csv
```
Outputs `data/train.csv` and `data/test.csv`.

### 4. Train the model
```bash
python train.py
```
Outputs `models/xgb_model.pkl` and prints evaluation metrics.

### 5. Run drift monitoring
```bash
python monitor.py
```
Outputs `reports/monitoring_report.txt`.

### 6. Launch the Streamlit app
```bash
streamlit run app.py
```
Opens at [http://localhost:8501](http://localhost:8501).

### 7. Run tests
```bash
pytest tests/test_pipeline.py -v
```

---

## ğŸ“Š Model

| Parameter      | Value        |
|----------------|-------------|
| Algorithm      | XGBoostClassifier |
| n_estimators   | 100         |
| max_depth      | 5           |
| learning_rate  | 0.1         |
| Train split    | 70%         |
| Test split     | 30%         |

### Evaluation (on real data)

| Metric    | Score  |
|-----------|--------|
| Accuracy  | 0.6728 |
| Precision | 0.6299 |
| Recall    | 0.2674 |
| F1-Score  | 0.3754 |

---

## ğŸ” Features Used

| Feature       | Description                        |
|---------------|------------------------------------|
| `Quantity`    | Number of units in the transaction |
| `UnitPrice`   | Price per unit (Â£)                 |
| `TotalPrice`  | Quantity Ã— UnitPrice               |
| `InvoiceHour` | Hour of day the invoice was raised |
| `InvoiceDay`  | Day of month the invoice was raised|

**Target**: `WillBuyNextMonth` â€” 1 if the customer made a purchase in the following month, else 0.

---

## ğŸŒŠ Drift Monitoring (Level 2)

Drift is simulated by modifying the test set:

```
Quantity  Ã—1.2   (more units per transaction)
UnitPrice Ã—0.8   (lower prices â€” e.g. sale period)
```

Detection logic:

```
prediction_change% = (# predictions that changed / total) Ã— 100

If prediction_change% > 10%  â†’  âš ï¸ DRIFT DETECTED
```

**Observed result**: `11.41%` â†’ Drift detected âœ…

---

## ğŸ— MLOps Levels

| Level | Implementation |
|-------|---------------|
| **0** | Manual training + Streamlit deployment |
| **1** | Scripted, reproducible pipeline (`download â†’ preprocess â†’ train â†’ evaluate â†’ save`) |
| **2** | Drift simulation, threshold detection, monitoring report |

---

## ğŸ§° Tech Stack

| Library        | Purpose                    |
|----------------|---------------------------|
| pandas / numpy | Data manipulation          |
| scikit-learn   | Preprocessing, metrics     |
| XGBoost        | Gradient boosted classifier|
| Streamlit      | Web UI deployment          |
| joblib         | Model serialisation        |
| kagglehub      | Dataset download           |
| matplotlib / seaborn | Visualisation       |

---

## ğŸ“‚ Data Source

**Online Retail II UCI** â€” Kaggle  
https://www.kaggle.com/datasets/mashlyn/online-retail-ii-uci  
UK-based online retail transactions: Dec 2009 â€“ Dec 2011  
~1,067,371 rows | 8 columns
